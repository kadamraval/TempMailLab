{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the TempInbox application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address (optional, if using Google login).",
          "format": "email"
        },
        "googleId": {
          "type": "string",
          "description": "User's Google ID (if using Google login)."
        },
        "isPremium": {
          "type": "boolean",
          "description": "Indicates if the user has a premium (ad-free) account."
        },
        "apiKeyId": {
          "type": "string",
          "description": "Reference to the API key, if this user is a developer using the API. (Relationship: User 1:1 ApiKey)"
        }
      },
      "required": [
        "id"
      ]
    },
    "Inbox": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Inbox",
      "type": "object",
      "description": "Represents a temporary email inbox.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the inbox."
        },
        "emailAddress": {
          "type": "string",
          "description": "The temporary email address for this inbox."
        },
        "expirationTime": {
          "type": "string",
          "description": "The date and time when the inbox will expire.",
          "format": "date-time"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who created this inbox. (Relationship: User 1:N Inbox)"
        }
      },
      "required": [
        "id",
        "emailAddress",
        "expirationTime"
      ]
    },
    "Email": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Email",
      "type": "object",
      "description": "Represents a single email message within an inbox.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the email."
        },
        "inboxId": {
          "type": "string",
          "description": "Reference to the inbox this email belongs to. (Relationship: Inbox 1:N Email)"
        },
        "senderName": {
          "type": "string",
          "description": "Name of the email sender."
        },
        "subject": {
          "type": "string",
          "description": "Subject line of the email."
        },
        "timeReceived": {
          "type": "string",
          "description": "The date and time the email was received.",
          "format": "date-time"
        },
        "htmlContent": {
          "type": "string",
          "description": "HTML content of the email."
        },
        "plainTextContent": {
          "type": "string",
          "description": "Plain text content of the email."
        }
      },
      "required": [
        "id",
        "inboxId",
        "senderName",
        "subject",
        "timeReceived"
      ]
    },
    "ApiKey": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiKey",
      "type": "object",
      "description": "Represents an API key for developers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the API key."
        },
        "key": {
          "type": "string",
          "description": "The API key itself."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user (developer) who owns this API key. (Relationship: User 1:1 ApiKey)"
        },
        "usageLogs": {
          "type": "array",
          "description": "References to the usage logs for this Api Key (Relationship: ApiKey 1:N UsageLog)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "key"
      ]
    },
    "UsageLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UsageLog",
      "type": "object",
      "description": "Represents a usage log entry for a developer API key.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the usage log entry."
        },
        "apiKeyId": {
          "type": "string",
          "description": "Reference to the API key this log entry belongs to. (Relationship: ApiKey 1:N UsageLog)"
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time of the API usage.",
          "format": "date-time"
        },
        "endpoint": {
          "type": "string",
          "description": "The API endpoint that was accessed."
        },
        "requestBody": {
          "type": "string",
          "description": "The request body sent to the API."
        }
      },
      "required": [
        "id",
        "apiKeyId",
        "timestamp",
        "endpoint"
      ]
    },
    "AdminSetting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminSetting",
      "type": "object",
      "description": "Admin settigns for error handling and the like.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin setting."
        },
        "settingName": {
          "type": "string",
          "description": "The name of the configuration setting."
        },
        "settingValue": {
          "type": "string",
          "description": "The value of the configuration setting."
        },
        "description": {
          "type": "string",
          "description": "Description of the configuration setting."
        }
      },
      "required": [
        "id",
        "settingName",
        "settingValue"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. Uses path-based ownership for simple security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/inboxes/{inboxId}",
        "definition": {
          "entityName": "Inbox",
          "schema": {
            "$ref": "#/backend/entities/Inbox"
          },
          "description": "Stores inboxes for each user. Uses path-based ownership. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "inboxId",
              "description": "The unique identifier for the inbox."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/inboxes/{inboxId}/emails/{emailId}",
        "definition": {
          "entityName": "Email",
          "schema": {
            "$ref": "#/backend/entities/Email"
          },
          "description": "Stores emails within an inbox. Uses path-based ownership. Includes denormalized 'userId' and 'inboxId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "inboxId",
              "description": "The unique identifier for the inbox."
            },
            {
              "name": "emailId",
              "description": "The unique identifier for the email."
            }
          ]
        }
      },
      {
        "path": "/api_keys/{apiKeyId}",
        "definition": {
          "entityName": "ApiKey",
          "schema": {
            "$ref": "#/backend/entities/ApiKey"
          },
          "description": "Stores API keys.  Each API Key is accessible via its ID.",
          "params": [
            {
              "name": "apiKeyId",
              "description": "The unique identifier for the API key."
            }
          ]
        }
      },
      {
        "path": "/api_keys/{apiKeyId}/usage_logs/{usageLogId}",
        "definition": {
          "entityName": "UsageLog",
          "schema": {
            "$ref": "#/backend/entities/UsageLog"
          },
          "description": "Stores usage logs for each API key.",
          "params": [
            {
              "name": "apiKeyId",
              "description": "The unique identifier for the API key."
            },
            {
              "name": "usageLogId",
              "description": "The unique identifier for the usage log."
            }
          ]
        }
      },
      {
        "path": "/admin_settings/{settingId}",
        "definition": {
          "entityName": "AdminSetting",
          "schema": {
            "$ref": "#/backend/entities/AdminSetting"
          },
          "description": "Stores global admin settings. Accessed only by admins.",
          "params": [
            {
              "name": "settingId",
              "description": "The unique identifier for the admin setting."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "A document in this collection existing flags the user as an administrator.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and debuggability, adhering to the principles of Authorization Independence and Structural Segregation. User data, inboxes, emails, API keys, usage logs, and admin settings are stored in separate collections, enabling granular access control.\n\n*   **Authorization Independence:**  The structure eliminates `get()` calls in security rules by denormalizing authorization data. For example, in `/users/{userId}/inboxes/{inboxId}`, the `userId` is explicitly part of the path, enabling path-based ownership rules.\n\n*   **Structural Segregation:**  Each collection houses documents with similar security requirements. User-owned data (inboxes, emails) resides under `/users/{userId}`, while global admin settings reside in `/admin_settings`. This segregation simplifies rules and prevents unintended access.\n\n*   **Access Modeling:**  Path-based ownership is used for user-owned data (inboxes, emails). API key access is controlled via the `/api_keys/{apiKeyId}` collection. Usage logs are stored under `/api_keys/{apiKeyId}/usage_logs/{usageLogId}`, linking directly to the API key. The membership map pattern is not required here, but could be considered if sharing of inboxes were to be implemented in the future. Admin settings are secured by existence check in dedicated collection.\n\n*   **QAPs (Rules are not Filters):** List operations are secured by the path-based ownership model. For example, listing inboxes under `/users/{userId}/inboxes` only returns inboxes owned by the specified user, preventing unauthorized data access.  The structure does not require rules to filter content. An admin-only collection like `/admin_settings` has stricter rules based on roles."
  }
}